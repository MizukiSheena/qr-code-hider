<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二维码艺术化工具 - AI生成</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="qr-art-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎨 二维码艺术化工具</h1>
            <p>上传二维码，AI生成看似普通图片但实际可扫描的艺术作品</p>
            <div class="version-badge">v3.0 AI Art</div>
        </header>

        <!-- 上传区域 -->
        <div class="upload-section">
            <div class="upload-card centered">
                <h3>📱 上传二维码</h3>
                <div class="upload-area" id="qrUploadArea">
                    <input type="file" id="qrInput" accept="image/*" style="display: none;">
                    <div class="upload-placeholder">
                        <div class="upload-icon">📱</div>
                        <p>点击或拖拽上传二维码图片</p>
                        <small>支持 PNG, JPG, JPEG 格式</small>
                    </div>
                </div>
                <div class="preview" id="qrPreview"></div>
            </div>
        </div>

        <!-- 二维码分析结果 -->
        <div class="analysis-section" id="analysisSection" style="display: none;">
            <h3>🔍 二维码分析</h3>
            <div class="qr-info" id="qrInfo">
                <!-- 二维码信息将显示在这里 -->
            </div>
        </div>

        <!-- 风格选择区域 -->
        <div class="style-section" id="styleSection" style="display: none;">
            <h3>🎨 选择艺术风格</h3>
            
            <div class="style-categories">
                <div class="category-tabs">
                    <button class="tab-btn active" data-category="structured">🎯 结构化风格</button>
                    <button class="tab-btn" data-category="custom">✨ 自定义</button>
                </div>

                <!-- 结构化风格 - 专门优化的3种风格 -->
                <div class="style-grid" id="structured-styles">
                    <div class="style-option" data-style="winter-village">
                        <div class="style-preview">❄️</div>
                        <div class="style-content">
                            <h4>雪景村庄</h4>
                            <p>深色房屋与白色雪地形成网格对比</p>
                            <div class="style-tags">
                                <span class="tag">高对比度</span>
                                <span class="tag">网格化</span>
                            </div>
                        </div>
                    </div>
                    <div class="style-option" data-style="forest-landscape">
                        <div class="style-preview">🌲</div>
                        <div class="style-content">
                            <h4>森林景观</h4>
                            <p>深色树木与浅色空地的自然网格</p>
                            <div class="style-tags">
                                <span class="tag">自然对比</span>
                                <span class="tag">有机网格</span>
                            </div>
                        </div>
                    </div>
                    <div class="style-option" data-style="architectural-grid">
                        <div class="style-preview">🏛️</div>
                        <div class="style-content">
                            <h4>建筑网格</h4>
                            <p>现代建筑与广场的几何网格布局</p>
                            <div class="style-tags">
                                <span class="tag">几何对比</span>
                                <span class="tag">规整网格</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自定义提示词 -->
                <div class="custom-prompt" id="custom-styles" style="display: none;">
                    <div class="prompt-header">
                        <h4>🎨 自定义艺术描述</h4>
                        <p>描述您想要的艺术场景，系统会自动添加结构化约束以确保二维码可读性</p>
                    </div>
                    <div class="prompt-input-group">
                        <label for="customPrompt">场景描述：</label>
                        <textarea id="customPrompt" placeholder="例如：一个日本庭院，包含深色的建筑和浅色的沙石，按网格模式排列，樱花飘落在石径上..."></textarea>
                    </div>
                    <div class="prompt-tips">
                        <div class="tip-item">💡 <strong>关键要素</strong>：描述深色元素（建筑、树木、岩石等）和浅色元素（天空、雪地、水面等）</div>
                        <div class="tip-item">🎯 <strong>布局提示</strong>：提及"网格"、"规律分布"、"对比鲜明"等词汇有助于生成</div>
                        <div class="tip-item">⚡ <strong>效果保障</strong>：系统会自动添加结构约束以确保二维码可读性</div>
                    </div>
                </div>
            </div>

            <!-- 高级选项 -->
            <div class="advanced-options">
                <h4>🔧 高级选项</h4>
                <div class="option-group">
                    <label for="complexity">复杂度:</label>
                    <select id="complexity">
                        <option value="simple">简单 - 更容易扫描</option>
                        <option value="moderate" selected>中等 - 平衡美观与可读性</option>
                        <option value="complex">复杂 - 更具艺术性</option>
                    </select>
                </div>
                <div class="option-group">
                    <label for="colorScheme">色彩方案:</label>
                    <select id="colorScheme">
                        <option value="monochrome">黑白 - 最佳扫描性</option>
                        <option value="duotone" selected>双色调 - 平衡效果</option>
                        <option value="colorful">彩色 - 最佳视觉效果</option>
                    </select>
                </div>
                <div class="option-group">
                    <label for="artStyle">艺术风格:</label>
                    <select id="artStyle">
                        <option value="photorealistic" selected>写实风格</option>
                        <option value="impressionist">印象派</option>
                        <option value="minimalist">极简主义</option>
                        <option value="surrealist">超现实主义</option>
                    </select>
                </div>
            </div>

            <div class="generation-controls">
                <button id="generateBtn" class="primary-btn" disabled>
                    🎨 生成艺术二维码
                </button>
                <div class="generation-info">
                    <small>💡 生成时间约30-60秒，请耐心等待</small>
                </div>
            </div>
        </div>

        <!-- 生成结果区域 -->
        <div class="result-section" id="resultSection" style="display: none;">
            <h3>✨ 生成结果</h3>
            
            <!-- 生成状态 -->
            <div class="generation-status" id="generationStatus">
                <div class="status-indicator">
                    <div class="loading-spinner"></div>
                    <span class="status-text">正在分析二维码结构...</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- 结果展示 -->
            <div class="result-display" id="resultDisplay" style="display: none;">
                <div class="result-comparison">
                    <div class="comparison-item">
                        <h4>📱 原始二维码</h4>
                        <div class="original-qr" id="originalQR"></div>
                    </div>
                    <div class="comparison-arrow">→</div>
                    <div class="comparison-item">
                        <h4>🎨 艺术化结果</h4>
                        <div class="generated-art" id="generatedArt"></div>
                    </div>
                </div>

                <!-- 验证结果 -->
                <div class="verification-result" id="verificationResult">
                    <div class="verification-item">
                        <span class="label">扫描验证:</span>
                        <span class="status" id="scanStatus">验证中...</span>
                    </div>
                    <div class="verification-item">
                        <span class="label">数据匹配:</span>
                        <span class="status" id="dataMatch">检查中...</span>
                    </div>
                    <div class="verification-item">
                        <span class="label">艺术评分:</span>
                        <span class="status" id="artScore">计算中...</span>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="result-actions">
                    <button id="downloadArtBtn" class="primary-btn">💾 下载艺术二维码</button>
                    <button id="regenerateBtn" class="secondary-btn">🔄 重新生成</button>
                    <button id="newQRBtn" class="secondary-btn">📱 上传新二维码</button>
                </div>

                <!-- 使用提示 -->
                <div class="usage-tips">
                    <h4>📋 使用建议</h4>
                    <ul id="usageTipsList">
                        <!-- 动态生成的使用提示 -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 会话验证
        function checkSession() {
            const sessionToken = localStorage.getItem('qr_hider_session');
            const sessionTime = localStorage.getItem('qr_hider_session_time');
            
            if (!sessionToken || !sessionTime) {
                window.location.href = 'login.html';
                return false;
            }
            
            const now = new Date().getTime();
            const sessionAge = now - parseInt(sessionTime);
            
            if (sessionAge >= 24 * 60 * 60 * 1000) {
                localStorage.removeItem('qr_hider_session');
                localStorage.removeItem('qr_hider_session_time');
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }
        
        // 页面加载时检查会话
        if (!checkSession()) {
            // 会话无效，停止执行
        } else {
            // 会话有效，加载主脚本
            const script = document.createElement('script');
            script.src = 'qr-art-script.js';
            script.onload = function() {
                console.log('QR Art script loaded successfully');
                initializeQRArtApp();
            };
            document.body.appendChild(script);
        }
    </script>
</body>
</html>
